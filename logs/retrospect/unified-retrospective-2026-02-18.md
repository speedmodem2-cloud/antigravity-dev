# 통합 회고 보고서 — P1~P4 (2026-02-17 ~ 2026-02-18)

## 프로젝트 총괄

| #   | 프로젝트      | 유형       | 디자인/스택         | 날짜  | Phase        | dist   |
| --- | ------------- | ---------- | ------------------- | ----- | ------------ | ------ |
| P1  | portfolio     | 프론트엔드 | Synthwave           | 02-17 | 7/7          | 17MB\* |
| P2  | portfolio2    | 프론트엔드 | Brutalist           | 02-18 | 6/7 (1 skip) | 548KB  |
| P3  | portfolio3    | 프론트엔드 | Synthwave Enhanced  | 02-18 | 8/8          | 2.2MB  |
| P4  | shop-backend1 | 백엔드     | NestJS+MySQL+Docker | 02-18 | 7/7          | 863KB  |

\*P1 dist에 source map(.js.map) + PNG 이미지 포함 → 실제 배포 시 ~3MB 이하

---

## 토큰 비용 분석

| 프로젝트 | Opus       | Sonnet     | Gemini    | Haiku     | 합계        |
| -------- | ---------- | ---------- | --------- | --------- | ----------- |
| P1       | -          | -          | -         | -         | ~$4 (추정)  |
| P2       | $1.64      | $2.07      | $0.13     | $0.03     | $3.87       |
| P3       | $1.64      | $2.07      | $0.13     | $0.03     | $3.87       |
| P4       | $4.44      | $1.78      | -         | -         | $6.22       |
| **합계** | **~$7.72** | **~$5.92** | **$0.26** | **$0.06** | **~$17.96** |

### 모델별 비중

- Opus: ~43% (P4 단독이면 71%)
- Sonnet: ~33%
- Gemini + Haiku: ~2%
- P1 추정분: ~22%

### 프로젝트별 효율

- **P2가 가장 효율적**: $3.87로 6컴포넌트, CSS 2레이어, 548KB dist
- **P4가 가장 비효율적**: Opus 지휘 비용이 전체의 71% ($4.44/$6.22)

---

## 기술 성장 궤적

```
P1 (프론트)          P2 (프론트)          P3 (프론트)          P4 (백엔드)
───────────────────────────────────────────────────────────────────────────
Vite + React         동일 스택 재사용      이미지 전략 추가       NestJS + TypeORM
Synthwave 디자인     Brutalist 디자인     Synthwave 고도화      MySQL + Docker
기본 컴포넌트        타이포그래피 중심     blend-mode, orbs     JWT + Passport
이미지 에셋          no-image 도전        고급 CSS 레이어      Cart → Order 트랜잭션
                    데이터/디자인 분리                         검색/필터/페이지네이션
                                                            E2E 31개 테스트
```

### 새로 배운 핵심 기술

| Phase | 기술                                                                    |
| ----- | ----------------------------------------------------------------------- |
| P1    | Vite, React, CSS 애니메이션, WebP 이미지 최적화                         |
| P2    | CSS-only 비주얼 레이어(ghost text, dot patterns), 타이포그래피 시스템   |
| P3    | CSS blend-mode, fixed bg overlay, ambient glow orbs, 이미지 전략 결정   |
| P4    | NestJS 모듈 시스템, TypeORM 관계, JWT 비동기 등록, 트랜잭션, E2E 테스트 |

---

## 오케스트레이션 진화

### P1~P3: 프론트엔드 파이프라인

- Opus 지휘 → Sonnet 구현 → Gemini 리뷰 → Haiku 문서
- 4모델 협업, 균형 잡힌 비용 분배
- Phase 스킵 문제 발견 → P2에서 확인 규칙 수립

### P4: 백엔드 전환

- Gemini/Haiku 미활용 → Opus+Sonnet 2모델 체제
- Opus 비중 급증 (71%) → 지휘 비용 절감 필요성 확인
- 병렬 디스패치 패턴 확립 (phase별 2~3 Sonnet 에이전트)
- 서브에이전트 14세션 운용 (P2~P3 대비 2.8배)

### 교훈: Opus 역할 축소 필요

```
현재:  Opus ──── 판단 + 리뷰 + 디버깅 + 재디스패치 ──── 71%
목표:  Opus ──── Phase 전환 + 최종 리뷰만 ──────────── <20%
방법:  Sonnet에게 자체 빌드 검증 + 판단 위임
```

---

## 반복된 문제 (4개 프로젝트 공통)

### 1. 대형 커밋 (전 프로젝트)

- 모든 프로젝트에서 10+ 파일 커밋 발생
- 원인: 서브에이전트가 모듈 전체를 한 번에 생성
- 해결: "모듈당 1커밋" 규칙을 서브에이전트 프롬프트에 포함

### 2. Phase 스킵 (P2)

- Phase 4 리뷰를 확인 없이 건너뜀
- 해결: "Phase skip = always confirm" 규칙 수립 → P3~P4에서 준수

### 3. 하드코딩 값 (P4)

- 테스트 이메일 고정 → DB 중복으로 실패
- JWT 시크릿 타이밍 미스매치
- 해결: 동적 값 생성 + registerAsync 패턴

### 4. dist 크기 관리 (P1)

- P1에서 17MB (source map + 이미지)
- P2~P3에서 개선 (548KB~2.2MB)
- 해결: .map 제외, WebP 이미지, no-image 전략

---

## KPT 종합

### Keep (유지)

- **Conventional Commits** — 전 프로젝트 준수
- **병렬 서브에이전트 디스패치** — Phase당 2~3 Sonnet 동시 실행
- **Phase 기반 파이프라인** — 체계적 진행 + TUI 모니터링
- **회고 + MEMORY 기록** — 교훈이 다음 프로젝트에 반영됨
- **디자인 다양화** — synthwave → brutalist → enhanced, 매번 새 도전

### Problem (문제)

- **Opus 비용 과다** — P4에서 71%, 전체 ~43%
- **대형 커밋** — 4개 프로젝트 모두 동일 문제
- **retrospect 도구 한계** — 프론트엔드 지표만 (CSS layer, component 수)
- **P1 회고 누락** — 초기 프로젝트라 retrospect 미실행

### Try (시도)

- **Opus <20% 목표** — P5(shop-backend2)에서 적용
- **모듈당 1커밋 규칙** — 서브에이전트 프롬프트에 명시
- **retrospect 도구 확장** — 백엔드 지표 (API 수, 엔티티 수, 테스트 커버리지)
- **E2E 선행 작성** — 구현 전 테스트 스켈레톤 생성
- **4모델 체제 복원** — 백엔드에서도 Gemini 리뷰 + Haiku 문서 활용

---

## 2일간 성과 요약

| 지표                  | 값                                     |
| --------------------- | -------------------------------------- |
| 기간                  | 2일 (02-17 ~ 02-18)                    |
| 완료 프로젝트         | 4개                                    |
| 총 Phase 수           | 29개 (스킵 1 포함)                     |
| 프론트엔드 컴포넌트   | 16+                                    |
| 백엔드 API 엔드포인트 | ~20개                                  |
| 백엔드 엔티티         | 5개                                    |
| E2E 테스트            | 31개 (전 통과)                         |
| 총 토큰 비용          | ~$18                                   |
| 다음 프로젝트         | shop-backend2 (실시간 경매, 계획 완료) |
